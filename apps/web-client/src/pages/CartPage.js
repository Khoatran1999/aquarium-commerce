import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { Helmet } from 'react-helmet-async';
import { Link } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { useAppDispatch, useAppSelector } from '../store';
import { updateCartItem, removeCartItem } from '../store/cart.slice';
import { Button } from '@repo/ui';
import toast from 'react-hot-toast';
export default function CartPage() {
    const dispatch = useAppDispatch();
    const { items, itemCount, loading } = useAppSelector((s) => s.cart);
    const subtotal = items.reduce((sum, i) => sum + i.price * i.quantity, 0);
    const shippingFee = subtotal > 0 ? (subtotal >= 100 ? 0 : 9.99) : 0;
    const total = subtotal + shippingFee;
    const handleUpdateQty = (itemId, quantity) => {
        if (quantity < 1)
            return;
        dispatch(updateCartItem({ itemId, quantity }))
            .unwrap()
            .catch((err) => toast.error(err));
    };
    const handleRemove = (itemId) => {
        dispatch(removeCartItem(itemId))
            .unwrap()
            .then(() => toast.success('Item removed'))
            .catch((err) => toast.error(err));
    };
    return (_jsxs(_Fragment, { children: [_jsxs(Helmet, { children: [_jsx("title", { children: "Cart \u2013 AquaLuxe" }), _jsx("meta", { name: "robots", content: "noindex" })] }), _jsxs("div", { className: "mx-auto max-w-[1280px] px-4 py-8 md:px-10", children: [_jsxs("h1", { className: "text-foreground text-2xl font-bold", children: ["Shopping Cart", ' ', itemCount > 0 && (_jsxs("span", { className: "text-muted-foreground text-lg font-normal", children: ["(", itemCount, " items)"] }))] }), items.length === 0 ? (_jsxs("div", { className: "flex flex-col items-center justify-center py-20 text-center", children: [_jsx("div", { className: "mb-4 text-6xl", children: "\uD83D\uDED2" }), _jsx("h2", { className: "text-foreground text-xl font-semibold", children: "Your cart is empty" }), _jsx("p", { className: "text-muted-foreground mt-2", children: "Discover our amazing ornamental fish collection." }), _jsx(Link, { to: "/products", children: _jsx(Button, { className: "mt-6", children: "Browse Products" }) })] })) : (_jsxs("div", { className: "mt-6 grid gap-8 lg:grid-cols-[1fr_360px]", children: [_jsx("div", { className: "flex flex-col gap-4", children: _jsx(AnimatePresence, { children: items.map((item) => (_jsxs(motion.div, { layout: true, initial: { opacity: 0, x: -20 }, animate: { opacity: 1, x: 0 }, exit: { opacity: 0, x: 20, height: 0 }, className: "bg-card border-border shadow-card flex gap-4 rounded-2xl border p-4", children: [_jsx(Link, { to: `/products/${item.product?.slug ?? ''}`, className: "h-24 w-24 shrink-0 overflow-hidden rounded-xl", children: _jsx("img", { src: item.product?.images?.[0]?.url ?? '/placeholder-fish.jpg', alt: item.product?.name ?? 'Product', className: "h-full w-full object-cover" }) }), _jsxs("div", { className: "flex min-w-0 flex-1 flex-col justify-between", children: [_jsxs("div", { children: [_jsx(Link, { to: `/products/${item.product?.slug ?? ''}`, children: _jsx("h3", { className: "text-foreground hover:text-primary line-clamp-1 font-semibold transition-colors", children: item.product?.name ?? 'Product' }) }), _jsxs("p", { className: "text-muted-foreground mt-0.5 text-xs", children: [item.product?.species?.name, " \u00B7 Size: ", item.product?.size] })] }), _jsxs("div", { className: "mt-2 flex items-center justify-between", children: [_jsxs("div", { className: "border-border flex items-center rounded-lg border", children: [_jsx("button", { onClick: () => handleUpdateQty(item.id, item.quantity - 1), disabled: loading || item.quantity <= 1, className: "text-foreground hover:bg-muted h-8 w-8 text-sm font-semibold transition-colors disabled:opacity-40", children: "-" }), _jsx("span", { className: "text-foreground w-8 text-center text-sm font-semibold", children: item.quantity }), _jsx("button", { onClick: () => handleUpdateQty(item.id, item.quantity + 1), disabled: loading, className: "text-foreground hover:bg-muted h-8 w-8 text-sm font-semibold transition-colors disabled:opacity-40", children: "+" })] }), _jsxs("div", { className: "flex items-center gap-3", children: [_jsxs("span", { className: "text-primary font-bold", children: ["$", (item.price * item.quantity).toFixed(2)] }), _jsx("button", { onClick: () => handleRemove(item.id), className: "text-muted-foreground hover:text-danger transition-colors", "aria-label": "Remove item", children: _jsx("svg", { className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" }) }) })] })] })] })] }, item.id))) }) }), _jsx("div", { className: "h-fit lg:sticky lg:top-24", children: _jsxs("div", { className: "bg-card border-border shadow-card rounded-2xl border p-6", children: [_jsx("h2", { className: "text-foreground mb-4 text-lg font-bold", children: "Order Summary" }), _jsxs("div", { className: "flex flex-col gap-3 text-sm", children: [_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-muted-foreground", children: "Subtotal" }), _jsxs("span", { className: "text-foreground font-medium", children: ["$", subtotal.toFixed(2)] })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-muted-foreground", children: "Shipping" }), _jsx("span", { className: "text-foreground font-medium", children: shippingFee === 0 ? (_jsx("span", { className: "text-success", children: "Free" })) : (`$${shippingFee.toFixed(2)}`) })] }), subtotal > 0 && subtotal < 100 && (_jsxs("p", { className: "text-info text-xs", children: ["Add $", (100 - subtotal).toFixed(2), " more for free shipping!"] })), _jsx("div", { className: "border-border my-1 border-t" }), _jsxs("div", { className: "flex justify-between text-base", children: [_jsx("span", { className: "text-foreground font-bold", children: "Total" }), _jsxs("span", { className: "text-primary text-xl font-bold", children: ["$", total.toFixed(2)] })] })] }), _jsx(Link, { to: "/checkout", children: _jsx(Button, { size: "lg", className: "mt-6 w-full", children: "Proceed to Checkout" }) }), _jsx(Link, { to: "/products", className: "text-primary mt-3 block text-center text-sm hover:underline", children: "Continue Shopping" })] }) })] }))] })] }));
}
